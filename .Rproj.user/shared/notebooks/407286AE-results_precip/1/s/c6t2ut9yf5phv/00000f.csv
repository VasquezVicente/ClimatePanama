"0","calculate_climatology<- function(minyear,maxyear,data){"
"0","    climatology<- data %>% "
"0","        dplyr::select(year,site,annual,jfma)%>%"
"0","        filter(year>=minyear&year<=maxyear)%>%"
"0","        group_by(site)%>%"
"0","        summarize(annual=mean(annual,na.rm=TRUE),"
"0","                jfma=mean(jfma,na.rm=TRUE))"
"0","    return(climatology)"
"0","}"
"0",""
"0","annual_pan<-function(list,extent){"
"0","  a<-lapply(list, raster)"
"0","  b<-raster::stack(a)"
"0","  c<-raster::calc(b,sum)"
"0","  d<-raster::crop(c,extent)"
"0","  return(d)"
"0","}"
"0",""
"0","jfma_pan <- function(list, extent) {"
"0","  a <- lapply(head(list, 4), raster)"
"0","  b <- raster::stack(a)"
"0","  c <- raster::calc(b, sum)"
"0","  d <- raster::crop(c, extent)"
"0","  return(d)"
"0","}"
"0",""
"0","find_nearest_non_na <- function(raster_object, coordinate) {"
"0","  non_na_cells <- which(!is.na(getValues(raster_object)))"
"0","  non_na_coords <- xyFromCell(raster_object, non_na_cells)"
"0","  dists <- sp::spDists(x = matrix(coordinate, nrow = 1), y = non_na_coords, longlat = TRUE)"
"0","  nearest_cell <- non_na_cells[which.min(dists)]"
"0","  return(getValues(raster_object)[nearest_cell])"
"0","}"
"0",""
"0","extract_land <- function(list_object, coordinate) {"
"0","  result <- numeric(nrow(coordinate))"
"0","  for (i in seq_len(nrow(coordinate))) {"
"0","    extracted_value <- raster::extract(list_object, coordinate[i, ], na.rm = FALSE)"
"0","    result[i] <- ifelse(is.na(extracted_value), find_nearest_non_na(list_object, as.matrix(coordinate[i, ])), extracted_value)"
"0","  }"
"0","  return(result)"
"0","}"
"0",""
"0","extract_sesonality<-function(list_object,coordinate, max_search_distance){"
"0","  vect<- ifelse(!is.na(raster::extract(list_object,coordinate,na.rm=FALSE)),"
"0","                raster::extract(list_object,coordinate,na.rm=FALSE),"
"0","                raster::extract(list_object,nearestLand(coordinate, list_object, 4000),na.rm=FALSE))"
"0","  return(vect)"
"0","}"
"0","#stats calculation"
"0","stats<-function(predicted,observed){"
"0","  correlation<-cor.test(observed,predicted)$estimate"
"0","  rmse<-sqrt(mean((predicted-observed)^2 , na.rm = TRUE ) )"
"0","  bias<- mean((predicted-observed),na.rm=TRUE)"
"0","  mae<-  mean(abs(predicted-observed), na.rm = TRUE)"
"0","  done<-c(correlation,rmse,bias,mae)"
"0","  return(done)"
"0","}"
