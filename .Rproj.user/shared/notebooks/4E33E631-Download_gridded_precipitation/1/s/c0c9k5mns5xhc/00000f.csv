"0","#| output: false"
"0","dataset_pbcor <- links %>% filter(source == ""PBCOR"" & type == ""correction factors"")"
"0","checkdir(dataset_pbcor$source[1])"
"1","[1]"
"1"," ""directory./data_reanalysis/PBCOR already exists"""
"1","
"
"0","process_data<- function(source,nc_file, orig_raster,outputfolder) {"
"0","  stacked<- raster::stack(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"",nc_file))"
"0","  cropped<- raster::crop(stacked, extentMap)"
"0","  orig<- list.files(paste0(""../data_reanalysis/"",orig_raster),pattern = "".tif"",full.names = TRUE)"
"0","  rasorig<- lapply(orig,raster)"
"0","  dir.create(paste0(""../data_reanalysis/"",source,""/"",outputfolder), showWarnings = FALSE)"
"0","    for (t in 1:nlayers(cropped)) {"
"0","      print(""writting"")"
"0","      chelsa_resampled<- raster::projectRaster(rasorig[[t]],cropped[[t]],method = ""ngb"")"
"0","      correctedfactor<- cropped[[t]]*chelsa_resampled"
"0","      writeRaster(correctedfactor, filename = paste0(""../data_reanalysis/"",source,""/"",outputfolder,""/"",sub(""//.nc$"","""",nc_file),""_"",t, "".tif""), format = ""GTiff"", overwrite = TRUE)"
"0","    }"
"0","}"
"0","if (dir.exists(""../data_reanalysis/PBCOR/CHELSA 1.2 corrected"") == FALSE) {"
"0","  download.file(dataset_pbcor$link[1], destfile = paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"", dataset_pbcor$filename[1]), method = ""libcurl"")"
"0","  unzip(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"", dataset_pbcor$filename[1]), exdir = paste0(""../data_reanalysis/"", dataset_pbcor$source[1]))"
"0","data<-list.files(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/""),pattern = "".nc"")  "
"0","process_data(""PBCOR"",data[1],""CHELSA 1.2"",""CHELSA 1.2 corrected"")"
"0","process_data(""PBCOR"",data[2],""CHPclim"",""CHPclim corrected"")"
"0","process_data(""PBCOR"",data[3],""WorldClim 2.1"",""WorldClim corrected"")"
"0","unlink(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"", dataset_pbcor$filename[1]))"
"0","unlink(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"", data[1]))"
"0","unlink(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"", data[2]))"
"0","unlink(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/"", data[3]))"
"0","unlink(paste0(""../data_reanalysis/"", dataset_pbcor$source[1], ""/readme.txt""))  "
"0","}else{"
"0","  print(""File already exists"")"
"0","}"
"1","[1]"
"1"," ""File already exists"""
"1","
"
